<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chỉnh s���a giải đấu - Tournament Manager</title>
    <link rel="stylesheet" href="../assets/styles/base.css">
    <link rel="stylesheet" href="../assets/styles/layout.css">
    <link rel="stylesheet" href="../assets/styles/components.css">
    <link rel="stylesheet" href="../assets/styles/dashboard.css">
    <link rel="stylesheet" href="../assets/styles/new-pages.css">
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-left">
            <button class="menu-btn">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 20H35M5 10H35M5 30H35" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            
            <div class="nav-item">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 36.6667V20H25V36.6667M5 15L20 3.33334L35 15V33.3333C35 34.2174 34.6488 35.0652 34.0237 35.6904C33.3986 36.3155 32.5507 36.6667 31.6667 36.6667H8.33333C7.44928 36.6667 6.60143 36.3155 5.97631 35.6904C5.35119 35.0652 5 34.2174 5 33.3333V15Z" stroke="#F5F5F5" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Trang chủ</span>
            </div>
        </div>
        
        <div class="header-center">
            <div class="search-container">
                <input type="text" placeholder="Tìm kiếm" class="search-input">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 4L4 12M4 4L12 12" stroke="#1E1E1E" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            
            <div class="nav-item">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.1507 15C15.5425 13.8861 16.3159 12.9469 17.3339 12.3486C18.3519 11.7503 19.5488 11.5316 20.7126 11.7312C21.8764 11.9308 22.932 12.5359 23.6924 13.4392C24.4529 14.3426 24.8691 15.4859 24.8673 16.6667C24.8673 20 19.8673 21.6667 19.8673 21.6667M20.0007 28.3333H20.0173M36.6673 20C36.6673 29.2048 29.2054 36.6667 20.0007 36.6667C10.7959 36.6667 3.33398 29.2048 3.33398 20C3.33398 10.7953 10.7959 3.33334 20.0007 3.33334C29.2054 3.33334 36.6673 10.7953 36.6673 20Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Hỗ trợ</span>
            </div>
            
            <div class="nav-item">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20.0007 26.6667V20M20.0007 13.3333H20.0173M36.6673 20C36.6673 29.2048 29.2054 36.6667 20.0007 36.6667C10.7959 36.6667 3.33398 29.2048 3.33398 20C3.33398 10.7953 10.7959 3.33334 20.0007 3.33334C29.2054 3.33334 36.6673 10.7953 36.6673 20Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Thông tin</span>
            </div>
        </div>
        
        <div class="header-right">
            <div class="info-section">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.9997 26.6666V19.9999M19.9997 13.3333H20.0163M36.6663 19.9999C36.6663 29.2047 29.2044 36.6666 19.9997 36.6666C10.7949 36.6666 3.33301 29.2047 3.33301 19.9999C3.33301 10.7952 10.7949 3.33325 19.9997 3.33325C29.2044 3.33325 36.6663 10.7952 36.6663 19.9999Z" stroke="#2C2C2C" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Cập nhật thông tin giải đấu</span>
            </div>
            
            <button class="notification-btn">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M27.46 42C27.1084 42.6062 26.6037 43.1093 25.9965 43.4591C25.3892 43.8088 24.7008 43.9929 24 43.9929C23.2992 43.9929 22.6108 43.8088 22.0035 43.4591C21.3963 43.1093 20.8916 42.6062 20.54 42M36 16C36 12.8174 34.7357 9.76516 32.4853 7.51472C30.2348 5.26428 27.1826 4 24 4C20.8174 4 17.7652 5.26428 15.5147 7.51472C13.2643 9.76516 12 12.8174 12 16C12 30 6 34 6 34H42C42 34 36 30 36 16Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            
            <div class="user-avatar">
                <img src="https://api.builder.io/api/v1/image/assets/TEMP/2791d338714d3870b4bb42ac5a5390446faac948?width=80" alt="User Avatar">
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="tournament-editor-page">
            <!-- Page Title -->
            <h1 class="page-title">Ch��nh sửa giải đấu của bạn</h1>
            
            <!-- Tournament Status Section -->
            <div class="tournament-status-section">
                <h2>Trạng thái giải đấu hiện tại:</h2>
                
                <!-- Tournament Bracket -->
                <div class="tournament-bracket">
                    <!-- Round 1 -->
                    <div class="bracket-round">
                        <div class="match-container">
                            <div class="match-item draggable" data-match="M1">M1</div>
                        </div>
                        <div class="match-container">
                            <div class="match-item draggable" data-match="M1">M1</div>
                        </div>
                    </div>
                    
                    <!-- Round 2 -->
                    <div class="bracket-round">
                        <div class="match-container">
                            <div class="match-item draggable" data-match="M7">M7</div>
                        </div>
                    </div>
                    
                    <!-- Finals -->
                    <div class="bracket-round finals">
                        <div class="match-container">
                            <div class="match-item draggable vertical" data-match="M5">M5</div>
                            <div class="match-item draggable vertical" data-match="M6">M6</div>
                        </div>
                        <div class="final-match">
                            <div class="match-item draggable" data-match="M2">M2</div>
                        </div>
                    </div>
                    
                    <!-- Round 3 -->
                    <div class="bracket-round">
                        <div class="match-container">
                            <div class="match-item draggable" data-match="M3">M3</div>
                        </div>
                        <div class="match-container">
                            <div class="match-item draggable" data-match="M4">M4</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Match Results Section -->
            <div class="match-results-section">
                <h2>Cập nhật kết quả các trận đấu:</h2>
                
                <div class="match-results-grid">
                    <div class="match-navigation">
                        <button class="nav-btn prev">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M38 24H10M10 24L24 38M10 24L24 10" stroke="#F19EDC" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="matches-container" id="matchesContainer">
                        <div class="loading-message">Đang tải trận đấu...</div>
                    </div>
                    
                    <div class="match-navigation">
                        <button class="nav-btn next">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M10 24H38M38 24L24 10M38 24L24 38" stroke="#F19EDC" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="save-section">
                    <button class="btn-save-tournament">Xác nhận lưu</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section social-links">
                <h4>Liên hệ với chúng tôi:</h4>
                <div class="social-icons">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_175_6014)">
                            <path d="M45.0792 12.84C44.8416 11.8908 44.3578 11.0211 43.6765 10.3188C42.9952 9.61648 42.1407 9.10637 41.1992 8.84C37.7592 8 23.9992 8 23.9992 8C23.9992 8 10.2392 8 6.79919 8.92C5.85768 9.18637 5.00314 9.69648 4.32188 10.3988C3.64062 11.1011 3.15677 11.9708 2.91919 12.92C2.28962 16.4111 1.98166 19.9526 1.99919 23.5C1.97675 27.0741 2.28473 30.6426 2.91919 34.16C3.18111 35.0797 3.6758 35.9163 4.35548 36.589C5.03515 37.2616 5.87683 37.7476 6.79919 38C10.2392 38.92 23.9992 38.92 23.9992 38.92C23.9992 38.92 37.7592 38.92 41.1992 38C42.1407 37.7336 42.9952 37.2235 43.6765 36.5212C44.3578 35.8189 44.8416 34.9492 45.0792 34C45.7039 30.5352 46.0118 27.0207 45.9992 23.5C46.0216 19.9259 45.7137 16.3574 45.0792 12.84Z" stroke="#F5F5F5" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19.4992 30.04L30.9992 23.5L19.4992 16.96V30.04Z" stroke="#F5F5F5" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                        </g>
                    </svg>
                    
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M35 13H35.02M14 4H34C39.5228 4 44 8.47715 44 14V34C44 39.5228 39.5228 44 34 44H14C8.47715 44 4 39.5228 4 34V14C4 8.47715 8.47715 4 14 4ZM32 22.74C32.2468 24.4045 31.9625 26.1044 31.1875 27.598C30.4125 29.0916 29.1863 30.3028 27.6833 31.0593C26.1802 31.8159 24.4769 32.0792 22.8156 31.8119C21.1543 31.5445 19.6195 30.7602 18.4297 29.5703C17.2398 28.3805 16.4555 26.8457 16.1881 25.1844C15.9208 23.5231 16.1841 21.8198 16.9407 20.3167C17.6972 18.8137 18.9084 17.5875 20.402 16.8125C21.8956 16.0375 23.5955 15.7532 25.26 16C26.9578 16.2518 28.5297 17.0429 29.7434 18.2566C30.9571 19.4703 31.7482 21.0422 32 22.74Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M36 4H30C27.3478 4 24.8043 5.05357 22.9289 6.92893C21.0536 8.8043 20 11.3478 20 14V20H14V28H20V44H28V28H34L36 20H28V14C28 13.4696 28.2107 12.9609 28.5858 12.5858C28.9609 12.2107 29.4696 12 30 12H36V4Z" stroke="#F5F5F5" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 22V14M32 22V14M42 4H6V36H16V44L24 36H34L42 28V4Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <p>xxxxx@gmail.com</p>
            </div>
            
            <div class="footer-section info-items">
                <div class="info-item">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20.0007 26.6666V19.9999M20.0007 13.3333H20.0173M36.6673 19.9999C36.6673 29.2047 29.2054 36.6666 20.0007 36.6666C10.7959 36.6666 3.33398 29.2047 3.33398 19.9999C3.33398 10.7952 10.7959 3.33325 20.0007 3.33325C29.2054 3.33325 36.6673 10.7952 36.6673 19.9999Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Thông tin sử dụng</span>
                </div>
                
                <div class="info-item">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20.0007 26.6666V19.9999M20.0007 13.3333H20.0173M36.6673 19.9999C36.6673 29.2047 29.2054 36.6666 20.0007 36.6666C10.7959 36.6666 3.33398 29.2047 3.33398 19.9999C3.33398 10.7952 10.7959 3.33325 20.0007 3.33325C29.2054 3.33325 36.6673 10.7952 36.6673 19.9999Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Chính sách bảo mật</span>
                </div>
                
                <div class="info-item">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20.0007 26.6666V19.9999M20.0007 13.3333H20.0173M36.6673 19.9999C36.6673 29.2047 29.2054 36.6666 20.0007 36.6666C10.7959 36.6666 3.33398 29.2047 3.33398 19.9999C3.33398 10.7952 10.7959 3.33325 20.0007 3.33325C29.2054 3.33325 36.6673 10.7952 36.6673 19.9999Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Điều khoản sử dụng</span>
                </div>
            </div>
            
            <div class="footer-section preview-image">
                <img src="https://api.builder.io/api/v1/image/assets/TEMP/864f93cce04ef7ff368b493fae0117f8a41b6a1b?width=636" alt="Preview">
            </div>
        </div>
        
        <div class="footer-controls">
            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M42 42L33.3 33.3M22 16V28M16 22H28M38 22C38 30.8366 30.8366 38 22 38C13.1634 38 6 30.8366 6 22C6 13.1634 13.1634 6 22 6C30.8366 6 38 13.1634 38 22Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            
            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M42 42L33.3 33.3M16 22H28M38 22C38 30.8366 30.8366 38 22 38C13.1634 38 6 30.8366 6 22C6 13.1634 13.1634 6 22 6C30.8366 6 38 13.1634 38 22Z" stroke="#F3F3F3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        
        <div class="footer-bottom">
            <p>2025 All rights reserved</p>
        </div>
    </footer>

    <script type="module">
        import { apiCall, API_ENDPOINTS, TokenManager } from './js/api.js';

        let tournament = null;
        let matches = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            if (!TokenManager.isAuthenticated()) {
                window.location.href = 'login.html';
                return;
            }

            const currentUser = TokenManager.getCurrentUser();
            if (!currentUser || currentUser.role !== 'organizer') {
                alert('Access denied. Organizer role required.');
                window.location.href = 'dashboard.html';
                return;
            }

            // Get tournament ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const tournamentId = urlParams.get('id');

            if (!tournamentId) {
                alert('Tournament ID is required');
                window.location.href = 'tournament-management.html';
                return;
            }

            loadTournamentData(tournamentId, currentUser._id);
        });

        async function loadTournamentData(tournamentId, userId) {
            try {
                // Load tournament details
                const tournamentResponse = await apiCall(`${API_ENDPOINTS.TOURNAMENTS.BY_ID(tournamentId)}`, {}, 'GET', true);

                if (!tournamentResponse.success) {
                    alert('Tournament not found');
                    window.location.href = 'tournament-management.html';
                    return;
                }

                tournament = tournamentResponse.data.tournament;

                // Check if user is the organizer
                if (tournament.organizerId._id !== userId && tournament.organizerId !== userId) {
                    alert('You can only edit your own tournaments');
                    window.location.href = 'tournament-management.html';
                    return;
                }

                // Update page title
                document.title = `Chỉnh sửa ${tournament.name} - Tournament Manager`;

                // Load matches for this tournament
                await loadMatches(tournamentId);

                // Update bracket display
                updateBracketDisplay();

            } catch (error) {
                console.error('Error loading tournament data:', error);
                alert('Error loading tournament data');
                window.location.href = 'tournament-management.html';
            }
        }

        async function loadMatches(tournamentId) {
            try {
                const response = await apiCall(`${API_ENDPOINTS.MATCHES.BY_TOURNAMENT(tournamentId)}`, {}, 'GET', true);

                if (response.success) {
                    matches = response.data.matches || [];
                } else {
                    matches = [];
                }

                renderMatches();
            } catch (error) {
                console.error('Error loading matches:', error);
                matches = [];
                renderMatches();
            }
        }

        function renderMatches() {
            const container = document.getElementById('matchesContainer');

            if (matches.length === 0) {
                container.innerHTML = `
                    <div class="no-matches">
                        <p>Chưa có trận đấu nào được tạo.</p>
                        <button onclick="generateMatches()" class="btn-generate-matches">
                            Tạo lịch thi đấu
                        </button>
                    </div>
                `;
                return;
            }

            // Group matches into rows (2 per row)
            const matchRows = [];
            for (let i = 0; i < matches.length; i += 2) {
                matchRows.push(matches.slice(i, i + 2));
            }

            const matchesHTML = matchRows.map(row => `
                <div class="match-row">
                    ${row.map(match => `
                        <div class="match-result-item clickable" onclick="openMatchEditor('${match._id}')">
                            <div class="match-teams">
                                <span class="team-1">${match.team1 || 'TBD'}</span>
                                <span class="vs">VS</span>
                                <span class="team-2">${match.team2 || 'TBD'}</span>
                            </div>
                            <div class="match-info">
                                ${match.result ? `<div class="match-result">${match.result}</div>` : ''}
                                <div class="match-status">${getMatchStatusText(match.status)}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');

            container.innerHTML = matchesHTML;
        }

        function getMatchStatusText(status) {
            const statusMap = {
                'scheduled': 'Đã lên lịch',
                'live': 'Đang diễn ra',
                'completed': 'Đã kết thúc',
                'cancelled': 'Đã hủy'
            };
            return statusMap[status] || status;
        }

        window.openMatchEditor = function(matchId) {
            const match = matches.find(m => m._id === matchId);
            if (!match) {
                alert('Match not found');
                return;
            }

            showMatchEditModal(match);
        };

        function showMatchEditModal(match) {
            const modal = createMatchEditModal(match);
            document.body.appendChild(modal);
        }

        function createMatchEditModal(match) {
            const modal = document.createElement('div');
            modal.className = 'match-edit-modal';
            modal.innerHTML = `
                <div class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Cập nhật kết quả trận đấu</h3>
                            <button class="close-btn" onclick="closeMatchModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="match-teams-display">
                                <span class="team">${match.team1 || 'TBD'}</span>
                                <span class="vs">VS</span>
                                <span class="team">${match.team2 || 'TBD'}</span>
                            </div>

                            <div class="form-group">
                                <label>Kết quả:</label>
                                <input type="text" id="matchResult" value="${match.result || ''}"
                                       placeholder="Ví dụ: 2-1, Team A thắng, etc.">
                            </div>

                            <div class="form-group">
                                <label>Trạng thái:</label>
                                <select id="matchStatus">
                                    <option value="scheduled" ${match.status === 'scheduled' ? 'selected' : ''}>Đã lên lịch</option>
                                    <option value="live" ${match.status === 'live' ? 'selected' : ''}>Đang diễn ra</option>
                                    <option value="completed" ${match.status === 'completed' ? 'selected' : ''}>Đã kết thúc</option>
                                    <option value="cancelled" ${match.status === 'cancelled' ? 'selected' : ''}>Đã hủy</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Người thắng (tùy chọn):</label>
                                <select id="matchWinner">
                                    <option value="">Chưa xác định</option>
                                    <option value="${match.team1}" ${match.winner === match.team1 ? 'selected' : ''}>${match.team1 || 'Team 1'}</option>
                                    <option value="${match.team2}" ${match.winner === match.team2 ? 'selected' : ''}>${match.team2 || 'Team 2'}</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-cancel" onclick="closeMatchModal()">Hủy</button>
                            <button class="btn-save" onclick="saveMatchResult('${match._id}')">Lưu</button>
                        </div>
                    </div>
                </div>
            `;

            // Add modal styles
            const style = document.createElement('style');
            style.textContent = `
                .match-edit-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: 1000;
                }

                .modal-overlay {
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }

                .modal-content {
                    background: white;
                    border-radius: 8px;
                    width: 90%;
                    max-width: 500px;
                    max-height: 90vh;
                    overflow-y: auto;
                }

                .modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1rem;
                    border-bottom: 1px solid #e2e8f0;
                }

                .modal-header h3 {
                    margin: 0;
                    color: #2d3748;
                }

                .close-btn {
                    background: none;
                    border: none;
                    font-size: 1.5rem;
                    cursor: pointer;
                    color: #718096;
                }

                .modal-body {
                    padding: 1rem;
                }

                .match-teams-display {
                    text-align: center;
                    margin-bottom: 1rem;
                    padding: 1rem;
                    background: #f7fafc;
                    border-radius: 8px;
                }

                .match-teams-display .team {
                    font-weight: 600;
                    color: #2d3748;
                }

                .match-teams-display .vs {
                    margin: 0 1rem;
                    color: #718096;
                }

                .form-group {
                    margin-bottom: 1rem;
                }

                .form-group label {
                    display: block;
                    margin-bottom: 0.5rem;
                    font-weight: 500;
                    color: #2d3748;
                }

                .form-group input,
                .form-group select {
                    width: 100%;
                    padding: 0.75rem;
                    border: 1px solid #e2e8f0;
                    border-radius: 6px;
                    font-size: 1rem;
                }

                .modal-footer {
                    display: flex;
                    justify-content: end;
                    gap: 0.5rem;
                    padding: 1rem;
                    border-top: 1px solid #e2e8f0;
                }

                .btn-cancel,
                .btn-save {
                    padding: 0.75rem 1.5rem;
                    border: none;
                    border-radius: 6px;
                    font-weight: 500;
                    cursor: pointer;
                }

                .btn-cancel {
                    background: #e2e8f0;
                    color: #2d3748;
                }

                .btn-save {
                    background: #667eea;
                    color: white;
                }

                .btn-save:hover {
                    background: #5a67d8;
                }

                .btn-generate-matches {
                    background: #667eea;
                    color: white;
                    border: none;
                    padding: 0.75rem 1.5rem;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 500;
                }

                .no-matches {
                    text-align: center;
                    padding: 2rem;
                    color: #718096;
                }

                .match-result-item {
                    border: 1px solid #e2e8f0;
                    border-radius: 8px;
                    padding: 1rem;
                    margin: 0.5rem;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    background: white;
                }

                .match-result-item:hover {
                    border-color: #667eea;
                    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
                }

                .match-teams {
                    text-align: center;
                    margin-bottom: 0.5rem;
                }

                .match-teams .team-1,
                .match-teams .team-2 {
                    font-weight: 600;
                    color: #2d3748;
                }

                .match-teams .vs {
                    margin: 0 0.5rem;
                    color: #718096;
                }

                .match-info {
                    text-align: center;
                    font-size: 0.9rem;
                }

                .match-result {
                    color: #667eea;
                    font-weight: 500;
                    margin-bottom: 0.25rem;
                }

                .match-status {
                    color: #718096;
                }

                .loading-message {
                    text-align: center;
                    padding: 2rem;
                    color: #718096;
                }
            `;
            modal.appendChild(style);

            return modal;
        }

        window.closeMatchModal = function() {
            const modal = document.querySelector('.match-edit-modal');
            if (modal) {
                document.body.removeChild(modal);
            }
        };

        window.saveMatchResult = async function(matchId) {
            const result = document.getElementById('matchResult').value.trim();
            const status = document.getElementById('matchStatus').value;
            const winner = document.getElementById('matchWinner').value;

            try {
                const updateData = {
                    result: result || null,
                    status: status,
                    winner: winner || null
                };

                const response = await apiCall(`${API_ENDPOINTS.MATCHES.BY_ID(matchId)}`, updateData, 'PUT', true);

                if (response.success) {
                    // Update local match data
                    const matchIndex = matches.findIndex(m => m._id === matchId);
                    if (matchIndex !== -1) {
                        matches[matchIndex] = { ...matches[matchIndex], ...updateData };
                    }

                    // Re-render matches
                    renderMatches();

                    // Close modal
                    closeMatchModal();

                    showNotification('Cập nhật kết quả thành công!', 'success');
                } else {
                    alert('Lỗi khi cập nhật kết quả: ' + response.message);
                }
            } catch (error) {
                console.error('Error updating match result:', error);
                alert('Có lỗi xảy ra khi cập nhật kết quả');
            }
        };

        window.generateMatches = async function() {
            if (!tournament || !tournament.competitor || tournament.competitor.length < 2) {
                alert('Cần ít nhất 2 đội để tạo lịch thi đấu');
                return;
            }

            if (confirm('Tạo lịch thi đấu cho giải đấu này?')) {
                try {
                    // This is a simplified match generation - in a real system,
                    // you'd implement proper bracket generation based on tournament format
                    const competitors = tournament.competitor;
                    const generatedMatches = [];

                    // Generate matches based on tournament format
                    if (tournament.format === 'single-elimination') {
                        // Simple elimination bracket
                        for (let i = 0; i < competitors.length; i += 2) {
                            if (i + 1 < competitors.length) {
                                generatedMatches.push({
                                    tournamentId: tournament._id,
                                    team1: competitors[i].name,
                                    team2: competitors[i + 1].name,
                                    round: 1,
                                    status: 'scheduled'
                                });
                            }
                        }
                    } else {
                        // For other formats, generate round-robin or group matches
                        for (let i = 0; i < competitors.length; i++) {
                            for (let j = i + 1; j < competitors.length; j++) {
                                generatedMatches.push({
                                    tournamentId: tournament._id,
                                    team1: competitors[i].name,
                                    team2: competitors[j].name,
                                    round: 1,
                                    status: 'scheduled'
                                });
                            }
                        }
                    }

                    // Create matches via API
                    const promises = generatedMatches.map(match =>
                        apiCall(API_ENDPOINTS.MATCHES.BASE, match, 'POST', true)
                    );

                    await Promise.all(promises);

                    // Reload matches
                    await loadMatches(tournament._id);

                    showNotification('Lịch thi đấu đã được tạo thành công!', 'success');
                } catch (error) {
                    console.error('Error generating matches:', error);
                    alert('Có lỗi xảy ra khi tạo lịch thi đấu');
                }
            }
        };

        function updateBracketDisplay() {
            // Update bracket visualization if needed
            // This could show a visual bracket based on tournament format
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Add CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }

            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
